



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta http-equiv="x-dns-prefetch-control" content="on">
      <link rel="dns-prefetch" href="//oi-wiki.org">
      <link rel="dns-prefetch" href="//search.oi-wiki.org">
      <link rel="dns-prefetch" href="//api.github.com">
      <link rel="dns-prefetch" href="//www.google-analytics.com">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="OI Wiki 是一个编程竞赛知识整合站点，提供有趣又实用的编程竞赛知识以及其他有帮助的内容，帮助广大编程竞赛爱好者更快更深入地学习编程竞赛">
      
      
        <link rel="canonical" href="https://www.wweiying.top/math/quick-pow/">
      
      
        <meta name="author" content="OI Wiki Team">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.2.4, mkdocs-material-4.4.2">
    
    
      
        <title>Quick pow - WWeiying's Learn-notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.6f7cfa25.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../assets/javascripts/modernizr.27508f0e.js"></script>
    
    
      
        <style>@font-face{font-family:'Fira Sans';font-style:normal;font-weight:300;src:url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.eot);src:local('Fira Sans'),local('FiraSans-Normal'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.svg#FiraSans) format('svg')}@font-face{font-family:'Fira Sans';font-style:normal;font-weight:regular;src:url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.eot);src:local('Fira Sans'),local('FiraSans-Normal'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.svg#FiraSans) format('svg')}@font-face{font-family:'Fira Sans';font-style:italic;font-weight:regular;src:url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.eot);src:local('Fira Sans'),local('FiraSans-Italic'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.svg#FiraSans) format('svg')}@font-face{font-family:'Fira Sans';font-style:normal;font-weight:700;src:url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.eot);src:local('Fira Sans'),local('FiraSans-Normal'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.svg#FiraSans) format('svg')}@font-face{font-family:'Fira Mono';font-style:normal;font-weight:regular;src:url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.eot);src:local('Fira Mono'),local('FiraMono-Normal'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.svg#FiraMono) format('svg')}body,input{font-family:"Fira Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/vendor/material-icons/iconfont/material-icons.css">
    
      <link rel="manifest" href="../../manifest.webmanifest">
    
    
      <link rel="stylesheet" href="../../_static/css/extra.css?v=13">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-124485594-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.wweiying.top/" title="WWeiying's Learn-notes" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              WWeiying's Learn-notes
            </span>
            <span class="md-header-nav__topic">
              
                Quick pow
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/WWeiying/Learn-notes/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    WWeiying/Learn-notes
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." class="md-tabs__link">
          简介
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://www.wweiying.top/" title="WWeiying's Learn-notes" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    WWeiying's Learn-notes
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/WWeiying/Learn-notes/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    WWeiying/Learn-notes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      简介
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        简介
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/about/" title="关于本项目" class="md-nav__link">
      关于本项目
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/htc/" title="如何参与" class="md-nav__link">
      如何参与
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/format/" title="格式手册" class="md-nav__link">
      格式手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/faq/" title="F.A.Q." class="md-nav__link">
      F.A.Q.
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/docker-deploy/" title="用 Docker 部署 OI Wiki" class="md-nav__link">
      用 Docker 部署 OI Wiki
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/mirrors/" title="镜像站列表" class="md-nav__link">
      镜像站列表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/thanks/" title="致谢" class="md-nav__link">
      致谢
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    算法描述
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    代码实现
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    应用
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    模意义下取幂
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    计算斐波那契数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    多次置换
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    加速几何中对点集的操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    定长路径计数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    模意义下大整数乘法
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    快速乘
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    高精度快速幂
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    同一底数与同一模数的预处理快速幂
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    习题
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    参考资料与注释
  </a>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="评论" class="md-nav__link md-nav__link--active">
            评论
          </a>
        </li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/WWeiying/Learn-notes/edit/master/docs/math/quick-pow.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Quick pow</h1>
                
                <p>快速幂，二进制取幂（Binary Exponentiation，也称平方法），是一个在 <span class="arithmatex"><span class="MathJax_Preview">\Theta(\log n)</span><script type="math/tex">\Theta(\log n)</script></span> 的时间内计算 <span class="arithmatex"><span class="MathJax_Preview">a^n</span><script type="math/tex">a^n</script></span> 的小技巧，而暴力的计算需要 <span class="arithmatex"><span class="MathJax_Preview">\Theta(n)</span><script type="math/tex">\Theta(n)</script></span> 的时间。而这个技巧也常常用在非计算的场景，因为它可以应用在任何具有结合律的运算中。其中显然的是它可以应用于模意义下取幂、矩阵幂等运算，我们接下来会讨论。</p>
<h2 id="_1">算法描述<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>计算 <span class="arithmatex"><span class="MathJax_Preview">a</span><script type="math/tex">a</script></span> 的 <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> 次方表示将 <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> 个 <span class="arithmatex"><span class="MathJax_Preview">a</span><script type="math/tex">a</script></span> 乘在一起：<span class="arithmatex"><span class="MathJax_Preview">a^{n} = \underbrace{a \times a \cdots \times a}_{n\text{ 个 a}}</span><script type="math/tex">a^{n} = \underbrace{a \times a \cdots \times a}_{n\text{ 个 a}}</script></span>。然而当 <span class="arithmatex"><span class="MathJax_Preview">a,n</span><script type="math/tex">a,n</script></span> 太大的时侯，这种方法就不太适用了。不过我们知道：<span class="arithmatex"><span class="MathJax_Preview">a^{b+c} = a^b \cdot a^c,\,\,a^{2b} = a^b \cdot a^b = (a^b)^2</span><script type="math/tex">a^{b+c} = a^b \cdot a^c,\,\,a^{2b} = a^b \cdot a^b = (a^b)^2</script></span>。二进制取幂的想法是，我们将取幂的任务按照指数的 <strong>二进制表示</strong> 来分割成更小的任务。</p>
<p>首先我们将 <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> 表示为 2 进制，举一个例子：</p>
<div class="arithmatex">
<div class="MathJax_Preview">
3^{13} = 3^{(1101)_2} = 3^8 \cdot 3^4 \cdot 3^1
</div>
<script type="math/tex; mode=display">
3^{13} = 3^{(1101)_2} = 3^8 \cdot 3^4 \cdot 3^1
</script>
</div>
<p>因为 <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> 有 <span class="arithmatex"><span class="MathJax_Preview">\lfloor \log_2 n \rfloor + 1</span><script type="math/tex">\lfloor \log_2 n \rfloor + 1</script></span> 个二进制位，因此当我们知道了 <span class="arithmatex"><span class="MathJax_Preview">a^1, a^2, a^4, a^8, \dots, a^{2^{\lfloor \log_2 n \rfloor}}</span><script type="math/tex">a^1, a^2, a^4, a^8, \dots, a^{2^{\lfloor \log_2 n \rfloor}}</script></span> 后，我们只用计算 <span class="arithmatex"><span class="MathJax_Preview">\Theta(\log n)</span><script type="math/tex">\Theta(\log n)</script></span> 次乘法就可以计算出 <span class="arithmatex"><span class="MathJax_Preview">a^n</span><script type="math/tex">a^n</script></span>。</p>
<p>于是我们只需要知道一个快速的方法来计算上述 3 的 <span class="arithmatex"><span class="MathJax_Preview">2^k</span><script type="math/tex">2^k</script></span> 次幂的序列。这个问题很简单，因为序列中（除第一个）任意一个元素就是其前一个元素的平方。举一个例子：</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\begin{align}
3^1 &amp;= 3 \\
3^2 &amp;= \left(3^1\right)^2 = 3^2 = 9 \\
3^4 &amp;= \left(3^2\right)^2 = 9^2 = 81 \\
3^8 &amp;= \left(3^4\right)^2 = 81^2 = 6561
\end{align}
</div>
<script type="math/tex; mode=display">
\begin{align}
3^1 &= 3 \\
3^2 &= \left(3^1\right)^2 = 3^2 = 9 \\
3^4 &= \left(3^2\right)^2 = 9^2 = 81 \\
3^8 &= \left(3^4\right)^2 = 81^2 = 6561
\end{align}
</script>
</div>
<p>因此为了计算 <span class="arithmatex"><span class="MathJax_Preview">3^{13}</span><script type="math/tex">3^{13}</script></span>，我们只需要将对应二进制位为 1 的整系数幂乘起来就行了：</p>
<div class="arithmatex">
<div class="MathJax_Preview">
3^{13} = 6561 \cdot 81 \cdot 3 = 1594323
</div>
<script type="math/tex; mode=display">
3^{13} = 6561 \cdot 81 \cdot 3 = 1594323
</script>
</div>
<p>将上述过程说得形式化一些，如果把 <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> 写作二进制为 <span class="arithmatex"><span class="MathJax_Preview">(n_tn_{t-1}\cdots n_1n_0)_2</span><script type="math/tex">(n_tn_{t-1}\cdots n_1n_0)_2</script></span>，那么有：</p>
<div class="arithmatex">
<div class="MathJax_Preview">
n = n_t2^t + n_{t-1}2^{t-1} + n_{t-2}2^{t-2} + \cdots + n_12^1 + n_02^0
</div>
<script type="math/tex; mode=display">
n = n_t2^t + n_{t-1}2^{t-1} + n_{t-2}2^{t-2} + \cdots + n_12^1 + n_02^0
</script>
</div>
<p>其中 <span class="arithmatex"><span class="MathJax_Preview">n_i\in\{0,1\}</span><script type="math/tex">n_i\in\{0,1\}</script></span>。那么就有</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\begin{aligned}
a^n &amp; = (a^{n_t 2^t + \cdots + n_0 2^0})\\\\
&amp; = a^{n_0 2^0} \times a^{n_1 2^1}\times \cdots \times a^{n_t2^t}
\end{aligned}
</div>
<script type="math/tex; mode=display">
\begin{aligned}
a^n & = (a^{n_t 2^t + \cdots + n_0 2^0})\\\\
& = a^{n_0 2^0} \times a^{n_1 2^1}\times \cdots \times a^{n_t2^t}
\end{aligned}
</script>
</div>
<p>根据上式我们发现，原问题被我们转化成了形式相同的子问题的乘积，并且我们可以在常数时间内从 <span class="arithmatex"><span class="MathJax_Preview">2^i</span><script type="math/tex">2^i</script></span> 项推出 <span class="arithmatex"><span class="MathJax_Preview">2^{i+1}</span><script type="math/tex">2^{i+1}</script></span> 项。</p>
<p>这个算法的复杂度是 <span class="arithmatex"><span class="MathJax_Preview">\Theta(\log n)</span><script type="math/tex">\Theta(\log n)</script></span> 的，我们计算了 <span class="arithmatex"><span class="MathJax_Preview">\Theta(\log n)</span><script type="math/tex">\Theta(\log n)</script></span> 个 <span class="arithmatex"><span class="MathJax_Preview">2^k</span><script type="math/tex">2^k</script></span> 次幂的数，然后花费 <span class="arithmatex"><span class="MathJax_Preview">\Theta(\log n)</span><script type="math/tex">\Theta(\log n)</script></span> 的时间选择二进制为 1 对应的幂来相乘。</p>
<h2 id="_2">代码实现<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>首先我们可以直接按照上述递归方法实现：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// C++ Version</span>
<span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">binpow</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binpow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Python Version</span>
<span class="k">def</span> <span class="nf">binpow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">binpow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">res</span> <span class="o">*</span> <span class="n">res</span> <span class="o">*</span> <span class="n">a</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">res</span> <span class="o">*</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
<p>第二种实现方法是非递归式的。它在循环的过程中将二进制位为 1 时对应的幂累乘到答案中。尽管两者的理论复杂度是相同的，但第二种在实践过程中的速度是比第一种更快的，因为递归会花费一定的开销。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// C++ Version</span>
<span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">binpow</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">&gt;&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Python Version</span>
<span class="k">def</span> <span class="nf">binpow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">*</span> <span class="n">a</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span>
        <span class="n">b</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
<p>模板：<a href="https://www.luogu.com.cn/problem/P1226">Luogu P1226</a></p>
<h2 id="_3">应用<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">模意义下取幂<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<details class="note" open="open">
<summary>问题描述</summary>
<p>计算 <span class="arithmatex"><span class="MathJax_Preview">x^n\bmod m</span><script type="math/tex">x^n\bmod m</script></span>。</p>
</details>
<p>这是一个非常常见的应用，例如它可以用于计算模意义下的乘法逆元。</p>
<p>既然我们知道取模的运算不会干涉乘法运算，因此我们只需要在计算的过程中取模即可。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// C++ Version</span>
<span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">binpow</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="o">%=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">&gt;&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Python Version</span>
<span class="k">def</span> <span class="nf">binpow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">%</span> <span class="n">m</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">*</span> <span class="n">a</span> <span class="o">%</span> <span class="n">m</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">%</span> <span class="n">m</span>
        <span class="n">b</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
<p>注意：根据费马小定理，如果 <span class="arithmatex"><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> 是一个质数，我们可以计算 <span class="arithmatex"><span class="MathJax_Preview">x^{n\bmod (m-1)}</span><script type="math/tex">x^{n\bmod (m-1)}</script></span> 来加速算法过程。</p>
<h3 id="_5">计算斐波那契数<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<details class="note" open="open">
<summary>问题描述</summary>
<p>计算斐波那契数列第 <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> 项 <span class="arithmatex"><span class="MathJax_Preview">F_n</span><script type="math/tex">F_n</script></span>。</p>
</details>
<p>根据斐波那契数列的递推式 <span class="arithmatex"><span class="MathJax_Preview">F_n = F_{n-1} + F_{n-2}</span><script type="math/tex">F_n = F_{n-1} + F_{n-2}</script></span>，我们可以构建一个 <span class="arithmatex"><span class="MathJax_Preview">2\times 2</span><script type="math/tex">2\times 2</script></span> 的矩阵来表示从 <span class="arithmatex"><span class="MathJax_Preview">F_i,F_{i+1}</span><script type="math/tex">F_i,F_{i+1}</script></span> 到 <span class="arithmatex"><span class="MathJax_Preview">F_{i+1},F_{i+2}</span><script type="math/tex">F_{i+1},F_{i+2}</script></span> 的变换。于是在计算这个矩阵的 <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> 次幂的时侯，我们使用快速幂的思想，可以在 <span class="arithmatex"><span class="MathJax_Preview">\Theta(\log n)</span><script type="math/tex">\Theta(\log n)</script></span> 的时间内计算出结果。对于更多的细节参见 <a href="../fibonacci/">斐波那契数列</a>。</p>
<h3 id="_6">多次置换<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<details class="note" open="open">
<summary>问题描述</summary>
<p>给你一个长度为 <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> 的序列和一个置换，把这个序列置换 <span class="arithmatex"><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 次。</p>
</details>
<p>简单地把这个置换取 <span class="arithmatex"><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 次幂，然后把它应用到序列 <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> 上即可。时间复杂度是 <span class="arithmatex"><span class="MathJax_Preview">O(n \log k)</span><script type="math/tex">O(n \log k)</script></span> 的。</p>
<p>注意：给这个置换建图，然后在每一个环上分别做 <span class="arithmatex"><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 次幂（事实上做一下 <span class="arithmatex"><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 对环长取模的运算即可）可以取得更高效的算法，达到 <span class="arithmatex"><span class="MathJax_Preview">O(n)</span><script type="math/tex">O(n)</script></span> 的复杂度。</p>
<h3 id="_7">加速几何中对点集的操作<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<blockquote>
<p>三维空间中，<span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> 个点 <span class="arithmatex"><span class="MathJax_Preview">p_i</span><script type="math/tex">p_i</script></span>，要求将 <span class="arithmatex"><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> 个操作都应用于这些点。包含 3 种操作：</p>
<ol>
<li>沿某个向量移动点的位置（Shift）。</li>
<li>按比例缩放这个点的坐标（Scale）。</li>
<li>绕某个坐标轴旋转（Rotate）。</li>
</ol>
<p>还有一个特殊的操作，就是将一个操作序列重复 <span class="arithmatex"><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 次（Loop），这个序列中也可能有 Loop 操作（Loop 操作可以嵌套）。现在要求你在低于 <span class="arithmatex"><span class="MathJax_Preview">O(n \cdot \textit{length})</span><script type="math/tex">O(n \cdot \textit{length})</script></span> 的时间内将这些变换应用到这个 <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> 个点，其中 <span class="arithmatex"><span class="MathJax_Preview">\textit{length}</span><script type="math/tex">\textit{length}</script></span> 表示把所有的 Loop 操作展开后的操作序列的长度。</p>
</blockquote>
<p>让我们来观察一下这三种操作对坐标的影响：</p>
<ol>
<li>Shift 操作：将每一维的坐标分别加上一个常量；</li>
<li>Scale 操作：把每一维坐标分别乘上一个常量；</li>
<li>Rotate 操作：这个有点复杂，我们不打算深入探究，不过我们仍然可以使用一个线性组合来表示新的坐标。</li>
</ol>
<p>可以看到，每一个变换可以被表示为对坐标的线性运算，因此，一个变换可以用一个 <span class="arithmatex"><span class="MathJax_Preview">4\times 4</span><script type="math/tex">4\times 4</script></span> 的矩阵来表示：</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\begin{bmatrix}
a_{11} &amp; a_ {12} &amp; a_ {13} &amp; a_ {14} \\
a_{21} &amp; a_ {22} &amp; a_ {23} &amp; a_ {24} \\
a_{31} &amp; a_ {32} &amp; a_ {33} &amp; a_ {34} \\
a_{41} &amp; a_ {42} &amp; a_ {43} &amp; a_ {44} \\
\end{bmatrix}
</div>
<script type="math/tex; mode=display">
\begin{bmatrix}
a_{11} & a_ {12} & a_ {13} & a_ {14} \\
a_{21} & a_ {22} & a_ {23} & a_ {24} \\
a_{31} & a_ {32} & a_ {33} & a_ {34} \\
a_{41} & a_ {42} & a_ {43} & a_ {44} \\
\end{bmatrix}
</script>
</div>
<p>使用这个矩阵就可以将一个坐标（向量）进行变换，得到新的坐标（向量）：</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\begin{bmatrix}
a_{11} &amp; a_ {12} &amp; a_ {13} &amp; a_ {14} \\
a_{21} &amp; a_ {22} &amp; a_ {23} &amp; a_ {24} \\
a_{31} &amp; a_ {32} &amp; a_ {33} &amp; a_ {34} \\
a_{41} &amp; a_ {42} &amp; a_ {43} &amp; a_ {44} \\
\end{bmatrix}\cdot
\begin{bmatrix} x \\ y \\ z \\ 1 \end{bmatrix}
 = \begin{bmatrix} x' \\ y' \\ z' \\ 1 \end{bmatrix}
</div>
<script type="math/tex; mode=display">
\begin{bmatrix}
a_{11} & a_ {12} & a_ {13} & a_ {14} \\
a_{21} & a_ {22} & a_ {23} & a_ {24} \\
a_{31} & a_ {32} & a_ {33} & a_ {34} \\
a_{41} & a_ {42} & a_ {43} & a_ {44} \\
\end{bmatrix}\cdot
\begin{bmatrix} x \\ y \\ z \\ 1 \end{bmatrix}
 = \begin{bmatrix} x' \\ y' \\ z' \\ 1 \end{bmatrix}
</script>
</div>
<p>你可能会问，为什么一个三维坐标会多一个 1 出来？原因在于，如果没有这个多出来的 1，我们没法使用矩阵的线性变换来描述 Shift 操作。</p>
<p>接下来举一些简单的例子来说明我们的思路：</p>
<ol>
<li>
<p>Shift 操作：让 <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 坐标方向的位移为 <span class="arithmatex"><span class="MathJax_Preview">5</span><script type="math/tex">5</script></span>，<span class="arithmatex"><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> 坐标的位移为 <span class="arithmatex"><span class="MathJax_Preview">7</span><script type="math/tex">7</script></span>，<span class="arithmatex"><span class="MathJax_Preview">z</span><script type="math/tex">z</script></span> 坐标的位移为 <span class="arithmatex"><span class="MathJax_Preview">9</span><script type="math/tex">9</script></span>：</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 5 \\
0 &amp; 1 &amp; 0 &amp; 7 \\
0 &amp; 0 &amp; 1 &amp; 9 \\
0 &amp; 0 &amp; 0 &amp; 1 \\
\end{bmatrix}
</div>
<script type="math/tex; mode=display">
\begin{bmatrix}
1 & 0 & 0 & 5 \\
0 & 1 & 0 & 7 \\
0 & 0 & 1 & 9 \\
0 & 0 & 0 & 1 \\
\end{bmatrix}
</script>
</div>
</li>
<li>
<p>Scale 操作：把 <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 坐标拉伸 10 倍，<span class="arithmatex"><span class="MathJax_Preview">y,z</span><script type="math/tex">y,z</script></span> 坐标拉伸 5 倍：</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\begin{bmatrix}
10 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 5 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 5 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 \\
\end{bmatrix}
</div>
<script type="math/tex; mode=display">
\begin{bmatrix}
10 & 0 & 0 & 0 \\
0 & 5 & 0 & 0 \\
0 & 0 & 5 & 0 \\
0 & 0 & 0 & 1 \\
\end{bmatrix}
</script>
</div>
</li>
<li>
<p>Rotate 操作：绕 <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 轴旋转 <span class="arithmatex"><span class="MathJax_Preview">\theta</span><script type="math/tex">\theta</script></span> 弧度，遵循右手定则（逆时针方向）</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; \cos \theta &amp; \sin \theta &amp; 0 \\
0 &amp; -\sin \theta &amp; \cos \theta &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 \\
\end{bmatrix}
</div>
<script type="math/tex; mode=display">
\begin{bmatrix}
1 & 0 & 0 & 0 \\
0 & \cos \theta & \sin \theta & 0 \\
0 & -\sin \theta & \cos \theta & 0 \\
0 & 0 & 0 & 1 \\
\end{bmatrix}
</script>
</div>
</li>
</ol>
<p>现在，每一种操作都被表示为了一个矩阵，变换序列可以用矩阵的乘积来表示，而一个 Loop 操作相当于取一个矩阵的 k 次幂。这样可以用 <span class="arithmatex"><span class="MathJax_Preview">O(m \log k)</span><script type="math/tex">O(m \log k)</script></span> 计算出整个变换序列最终形成的矩阵。最后将它应用到 <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> 个点上，总复杂度 <span class="arithmatex"><span class="MathJax_Preview">O(n + m \log k)</span><script type="math/tex">O(n + m \log k)</script></span>。</p>
<h3 id="_8">定长路径计数<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<details class="note" open="open">
<summary>问题描述</summary>
<p>给一个有向图（边权为 1），求任意两点 <span class="arithmatex"><span class="MathJax_Preview">u,v</span><script type="math/tex">u,v</script></span> 间从 <span class="arithmatex"><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> 到 <span class="arithmatex"><span class="MathJax_Preview">v</span><script type="math/tex">v</script></span>，长度为 <span class="arithmatex"><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 的路径的条数。</p>
</details>
<p>我们把该图的邻接矩阵 M 取 k 次幂，那么 <span class="arithmatex"><span class="MathJax_Preview">M_{i,j}</span><script type="math/tex">M_{i,j}</script></span> 就表示从 <span class="arithmatex"><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span> 到 <span class="arithmatex"><span class="MathJax_Preview">j</span><script type="math/tex">j</script></span> 长度为 <span class="arithmatex"><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 的路径的数目。该算法的复杂度是 <span class="arithmatex"><span class="MathJax_Preview">O(n^3 \log k)</span><script type="math/tex">O(n^3 \log k)</script></span>。有关该算法的细节请参见 <a href="../matrix/">矩阵</a> 页面。</p>
<h3 id="_9">模意义下大整数乘法<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<blockquote>
<p>计算 <span class="arithmatex"><span class="MathJax_Preview">a\times b\bmod m,\,\,a,b\le m\le 10^{18}</span><script type="math/tex">a\times b\bmod m,\,\,a,b\le m\le 10^{18}</script></span>。</p>
</blockquote>
<p>与二进制取幂的思想一样，这次我们将其中的一个乘数表示为若干个 2 的整数次幂的和的形式。因为在对一个数做乘 2 并取模的运算的时侯，我们可以转化为加减操作防止溢出。这样仍可以在 <span class="arithmatex"><span class="MathJax_Preview">O (\log_2 m)</span><script type="math/tex">O (\log_2 m)</script></span> 的时内解决问题。递归方法如下：</p>
<div class="arithmatex">
<div class="MathJax_Preview">
a \cdot b = \begin{cases}
0 &amp;\text{if }a = 0 \\\\
2 \cdot \frac{a}{2} \cdot b &amp;\text{if }a &gt; 0 \text{ and }a \text{ even} \\\\
2 \cdot \frac{a-1}{2} \cdot b + b &amp;\text{if }a &gt; 0 \text{ and }a \text{ odd}
\end{cases}
</div>
<script type="math/tex; mode=display">
a \cdot b = \begin{cases}
0 &\text{if }a = 0 \\\\
2 \cdot \frac{a}{2} \cdot b &\text{if }a > 0 \text{ and }a \text{ even} \\\\
2 \cdot \frac{a-1}{2} \cdot b + b &\text{if }a > 0 \text{ and }a \text{ odd}
\end{cases}
</script>
</div>
<h4 id="_10">快速乘<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<p>但是 <span class="arithmatex"><span class="MathJax_Preview">O(\log_2 m)</span><script type="math/tex">O(\log_2 m)</script></span> 的“龟速乘”还是太慢了，这在很多对常数要求比较高的算法比如 Miller_Rabin 和 Pollard-Rho 中，就显得不够用了。所以我们要介绍一种可以处理模数在 <code>long long</code> 范围内、不需要使用黑科技 <code>__int128</code> 的、复杂度为 <span class="arithmatex"><span class="MathJax_Preview">O(1)</span><script type="math/tex">O(1)</script></span> 的“快速乘”。</p>
<p>我们发现：</p>
<div class="arithmatex">
<div class="MathJax_Preview">
a\times b\bmod m=a\times b-\left\lfloor \dfrac{ab}m \right\rfloor\times m
</div>
<script type="math/tex; mode=display">
a\times b\bmod m=a\times b-\left\lfloor \dfrac{ab}m \right\rfloor\times m
</script>
</div>
<p>我们巧妙运用 <code>unsigned long long</code> 的自然溢出：</p>
<div class="arithmatex">
<div class="MathJax_Preview">
a\times b\bmod m=a\times b-\left\lfloor \dfrac{ab}m \right\rfloor\times m=\left(a\times b-\left\lfloor \dfrac{ab}m \right\rfloor\times m\right)\bmod 2^{64}
</div>
<script type="math/tex; mode=display">
a\times b\bmod m=a\times b-\left\lfloor \dfrac{ab}m \right\rfloor\times m=\left(a\times b-\left\lfloor \dfrac{ab}m \right\rfloor\times m\right)\bmod 2^{64}
</script>
</div>
<p>于是在算出 <span class="arithmatex"><span class="MathJax_Preview">\left\lfloor\dfrac{ab}m\right\rfloor</span><script type="math/tex">\left\lfloor\dfrac{ab}m\right\rfloor</script></span> 后，两边的乘法和中间的减法部分都可以使用 <code>unsigned long long</code> 直接计算，现在我们只需要解决如何计算 <span class="arithmatex"><span class="MathJax_Preview">\left\lfloor\dfrac {ab}m\right\rfloor</span><script type="math/tex">\left\lfloor\dfrac {ab}m\right\rfloor</script></span>。</p>
<p>我们考虑先使用 <code>long double</code> 算出 <span class="arithmatex"><span class="MathJax_Preview">\dfrac am</span><script type="math/tex">\dfrac am</script></span> 再乘上 <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>。</p>
<p>既然使用了 <code>long double</code>，就无疑会有精度误差。极端情况就是第一个有效数字（二进制下）在小数点后一位。在 <code>x86-64</code> 机器下，<code>long double</code> 将被解释成 <span class="arithmatex"><span class="MathJax_Preview">80</span><script type="math/tex">80</script></span> 位拓展小数（即符号为 <span class="arithmatex"><span class="MathJax_Preview">1</span><script type="math/tex">1</script></span> 位，指数为 <span class="arithmatex"><span class="MathJax_Preview">15</span><script type="math/tex">15</script></span> 位，尾数为 <span class="arithmatex"><span class="MathJax_Preview">64</span><script type="math/tex">64</script></span> 位），所以 <code>long double</code> 最多能精确表示的有效位数为 <span class="arithmatex"><span class="MathJax_Preview">64</span><script type="math/tex">64</script></span><sup id="fnref:note1"><a class="footnote-ref" href="#fn:note1">1</a></sup>。所以 <span class="arithmatex"><span class="MathJax_Preview">\dfrac am</span><script type="math/tex">\dfrac am</script></span> 最差从第 <span class="arithmatex"><span class="MathJax_Preview">65</span><script type="math/tex">65</script></span> 位开始出错，误差范围为 <span class="arithmatex"><span class="MathJax_Preview">\left(-2^{-64},2^{64}\right)</span><script type="math/tex">\left(-2^{-64},2^{64}\right)</script></span>。乘上 <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span> 这个 <span class="arithmatex"><span class="MathJax_Preview">64</span><script type="math/tex">64</script></span> 位整数，误差范围为 <span class="arithmatex"><span class="MathJax_Preview">(-0.5,0.5)</span><script type="math/tex">(-0.5,0.5)</script></span>，再加上 <span class="arithmatex"><span class="MathJax_Preview">0.5</span><script type="math/tex">0.5</script></span> 误差范围为 <span class="arithmatex"><span class="MathJax_Preview">(0,1)</span><script type="math/tex">(0,1)</script></span>，取整后误差范围位 <span class="arithmatex"><span class="MathJax_Preview">\{0,1\}</span><script type="math/tex">\{0,1\}</script></span>。于是乘上 <span class="arithmatex"><span class="MathJax_Preview">-m</span><script type="math/tex">-m</script></span> 后，误差范围变成 <span class="arithmatex"><span class="MathJax_Preview">\{0,-m\}</span><script type="math/tex">\{0,-m\}</script></span>，我们需要判断这两种情况。</p>
<p>因为 <span class="arithmatex"><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> 在 <code>long long</code> 范围内，所以如果计算结果 <span class="arithmatex"><span class="MathJax_Preview">r</span><script type="math/tex">r</script></span> 在 <span class="arithmatex"><span class="MathJax_Preview">[0,m)</span><script type="math/tex">[0,m)</script></span> 时，直接返回 <span class="arithmatex"><span class="MathJax_Preview">r</span><script type="math/tex">r</script></span>，否则返回 <span class="arithmatex"><span class="MathJax_Preview">r+m</span><script type="math/tex">r+m</script></span>，当然你也可以直接返回 <span class="arithmatex"><span class="MathJax_Preview">(r+m)\bmod m</span><script type="math/tex">(r+m)\bmod m</script></span>。</p>
<p>代码实现如下：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">binmul</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)((</span><span class="kt">long</span><span class="w"> </span><span class="kt">double</span><span class="p">)</span><span class="n">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5L</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<h3 id="_11">高精度快速幂<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<details class="note">
<summary>前置技能</summary>
<p>请先学习 <a href="../bignum/">高精度</a></p>
</details>
<details class="note" open="open">
<summary> 例题【NOIP2003 普及组改编·麦森数】（<a href="https://www.luogu.com.cn/problem/P1045">原题在此</a>）</summary>
<p>题目大意：从文件中输入 P（1000&lt;P&lt;3100000），计算 <span class="arithmatex"><span class="MathJax_Preview">2^P−1</span><script type="math/tex">2^P−1</script></span> 的最后 100 位数字（用十进制高精度数表示），不足 100 位时高位补 0。</p>
</details>
<p>代码实现如下：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>
</code></pre></div></td></tr></table></div>
<h3 id="_12">同一底数与同一模数的预处理快速幂<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>在同一底数与同一模数的条件下，可以利用分块思想，用一定的时间（一般是 <span class="arithmatex"><span class="MathJax_Preview">O(\sqrt n)</span><script type="math/tex">O(\sqrt n)</script></span>）预处理后用 <span class="arithmatex"><span class="MathJax_Preview">O(1)</span><script type="math/tex">O(1)</script></span> 的时间回答一次幂询问。</p>
<p>算法的具体步骤是：</p>
<ol>
<li>选定一个数 <span class="arithmatex"><span class="MathJax_Preview">s</span><script type="math/tex">s</script></span>，预处理出 <span class="arithmatex"><span class="MathJax_Preview">a^0</span><script type="math/tex">a^0</script></span> 到 <span class="arithmatex"><span class="MathJax_Preview">a^s</span><script type="math/tex">a^s</script></span> 与 <span class="arithmatex"><span class="MathJax_Preview">a^{0\cdot s}</span><script type="math/tex">a^{0\cdot s}</script></span> 到 <span class="arithmatex"><span class="MathJax_Preview">a^{\lceil\frac ps\rceil\cdot s}</span><script type="math/tex">a^{\lceil\frac ps\rceil\cdot s}</script></span> 的值并存在一个（或两个）数组里；</li>
<li>对于每一次询问 <span class="arithmatex"><span class="MathJax_Preview">a^b\bmod p</span><script type="math/tex">a^b\bmod p</script></span>，将 <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span> 拆分成 <span class="arithmatex"><span class="MathJax_Preview">\left\lfloor\dfrac bs\right\rfloor\cdot s+b\bmod s</span><script type="math/tex">\left\lfloor\dfrac bs\right\rfloor\cdot s+b\bmod s</script></span>，则 <span class="arithmatex"><span class="MathJax_Preview">a^b=a^{\lfloor\frac bs\rfloor\cdot s}\times a^{b\bmod s}</span><script type="math/tex">a^b=a^{\lfloor\frac bs\rfloor\cdot s}\times a^{b\bmod s}</script></span>，可以 <span class="arithmatex"><span class="MathJax_Preview">O(1)</span><script type="math/tex">O(1)</script></span> 求出答案。</li>
</ol>
<p>关于这个数 <span class="arithmatex"><span class="MathJax_Preview">s</span><script type="math/tex">s</script></span> 的选择，我们一般选择 <span class="arithmatex"><span class="MathJax_Preview">\sqrt p</span><script type="math/tex">\sqrt p</script></span> 或者一个大小适当的 <span class="arithmatex"><span class="MathJax_Preview">2</span><script type="math/tex">2</script></span> 的次幂（选择 <span class="arithmatex"><span class="MathJax_Preview">\sqrt p</span><script type="math/tex">\sqrt p</script></span> 可以使预处理较优，选择 <span class="arithmatex"><span class="MathJax_Preview">2</span><script type="math/tex">2</script></span> 的次幂可以使用位运算优化/简化计算）。</p>
<details class="note">
<summary> 参考代码</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">pow1</span><span class="p">[</span><span class="mi">65536</span><span class="p">],</span><span class="w"> </span><span class="n">pow2</span><span class="p">[</span><span class="mi">65536</span><span class="p">];</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">preproc</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">pow1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">65536</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">pow1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1L</span><span class="n">L</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pow1</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">pow65536</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1L</span><span class="n">L</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pow1</span><span class="p">[</span><span class="mi">65535</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">65536</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">pow2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1L</span><span class="n">L</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pow2</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pow65536</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">1L</span><span class="n">L</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pow1</span><span class="p">[</span><span class="n">pows</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">65535</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pow2</span><span class="p">[</span><span class="n">pows</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">];</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
</details>
<h2 id="_13">习题<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="http://uva.onlinejudge.org/index.php?option=com_onlinejudge&amp;Itemid=8&amp;category=24&amp;page=show_problem&amp;problem=3671">UVa 1230 - MODEX</a></li>
<li><a href="http://uva.onlinejudge.org/index.php?option=com_onlinejudge&amp;Itemid=8&amp;category=24&amp;page=show_problem&amp;problem=310">UVa 374 - Big Mod</a></li>
<li><a href="https://uva.onlinejudge.org/index.php?option=onlinejudge&amp;page=show_problem&amp;problem=1970">UVa 11029 - Leading and Trailing</a></li>
<li><a href="http://codeforces.com/problemset/problem/630/I">Codeforces - Parking Lot</a></li>
<li><a href="http://www.spoj.com/problems/LASTDIG/">SPOJ - The last digit</a></li>
<li><a href="http://www.spoj.com/problems/LOCKER/">SPOJ - Locker</a></li>
<li><a href="https://icpcarchive.ecs.baylor.edu/index.php?option=com_onlinejudge&amp;Itemid=8&amp;page=show_problem&amp;problem=1723">LA - 3722 Jewel-eating Monsters</a></li>
<li>
<p><a href="http://www.spoj.com/problems/ZSUM/">SPOJ - Just add it</a></p>
<p><strong>本页面部分内容译自博文 <a href="http://e-maxx.ru/algo/binary_pow">Бинарное возведение в степень</a> 与其英文翻译版 <a href="https://cp-algorithms.com/algebra/binary-exp.html">Binary Exponentiation</a>。其中俄文版版权协议为 Public Domain + Leave a Link；英文版版权协议为 CC-BY-SA 4.0。</strong></p>
</li>
</ul>
<h2 id="_14">参考资料与注释<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<div class="footnote">
<hr />
<ol>
<li id="fn:note1">
<p>参见 <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">C 语言小数表示法 - 维基百科</a>&#160;<a class="footnote-backref" href="#fnref:note1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
              
              
                 
 
 
<hr><blockquote class="page-copyright">
  <span><i class="md-icon">build</i>本页面最近更新：</span><span class="facts_modified"></span>，<a class="edit_history">更新历史</a><br>
  <span><i class="md-icon">edit</i>发现错误？想一起完善？ <a href="https://github.com/WWeiying/Learn-notes/edit/master/docs/math/quick-pow.md" title="编辑此页" class="page_edit_url">在 GitHub 上编辑此页！</a></span><br>
  <span><i class="md-icon">people</i>本页面贡献者：</span><span class="page_contributors">OI-wiki</span><br>
  <span><i class="md-icon">copyright</i>本页面的全部内容在 <strong><a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh">CC BY-SA 4.0</a> 和 <a href="https://github.com/zTrix/sata-license">SATA</a></strong> 协议之条款下提供，附加条款亦可能应用</span>
</blockquote>


<h2 id="__comments" data-no-instant>评论</h2>
<form id="gitalk-form" onsubmit="return!1" data-no-instant>
<div id="gitalk-container" data-no-instant>
</div>
</form>
<link rel="stylesheet" href="../../assets/vendor/gitalk/gitalk.css">
<script src="../../assets/vendor/gitalk/gitalk.min.js"></script>
<script>
  const gitalk = new Gitalk({
    id: 'Quick pow',
    owner: 'OI-wiki',
    repo: 'gitment',
    admin: ['Ir1d', 'cjsoft', 'TrisolarisHD', 'Xeonacid', 'sshwy', 'Enter-tainer', 'StudyingFather'],
    clientID: 'd6a911c8fba0194626d4',
    clientSecret: '867ec7e13cc99b420bd147cbb62d5cfec271ba81',
    distractionFreeMode: false,
    pagerDirection: 'first'
  })
  gitalk.render('gitalk-container')
</script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<script>function scrollFunction(){20<document.body.scrollTop||20<document.documentElement.scrollTop?document.getElementById("myBtn").style.display="block":document.getElementById("myBtn").style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}window.onscroll=function(){scrollFunction()}</script>
<button onclick="topFunction()" id="myBtn" class="data-tip-left" data-tip="回到顶部">
  <svg class="Zi Zi--BackToTop data-tip-left" data-tip="回到顶部" fill="currentColor" viewBox="0 0 24 24" width="24" height="24">
    <path d="M16.036 19.59a1 1 0 0 1-.997.995H9.032a.996.996 0 0 1-.997-.996v-7.005H5.03c-1.1 0-1.36-.633-.578-1.416L11.33 4.29a1.003 1.003 0 0 1 1.412 0l6.878 6.88c.782.78.523 1.415-.58 1.415h-3.004v7.005z"></path>
  </svg>
</button>
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2022 WWeiying
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
        <div id="miitbeian"></div>
      </div>
      
      <span style="float:right" class="build_date_utc"><a href="https://github.com/24OI/OI-wiki">最近更新：, 2022-04-29</a></span>
      <script>
        /* miitbeian */
        if (window.location.hostname == "oi-wiki.com") {
          document.getElementById("miitbeian").innerHTML = `<a href="http://beian.miit.gov.cn/">黑ICP备19005132号-2</a>`;
        }
        /* Easter Egg */
        console.log(`%c OI Wiki %c  %c`,"background:#35495e ; padding: 1px; border-radius: 3px 0 0 3px;  color: #fff","background:#41b883 ; padding: 1px; border-radius: 0 3px 3px 0;  color: #fff","background:transparent");
        console.log('少年，恭喜你囍提彩蛋，我们在做一些 OI 相关的有趣的事情，如果您对此感兴趣，欢迎访问 https://join-us.oi-wiki.org');
      </script>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.411a9f9f.js"></script>
      <script>app.initialize({version:"1.2.4",url:{base:"../.."}}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then(function(e){console.log("PWA Registration succeeded. Scope is "+e.scope)}).catch(function(e){console.log("PWA Registration failed with "+e)})</script>
      
        <script src="../../_static/js/extra.js?v=16"></script>
      
        <script src="../../assets/vendor/mathjax/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>